
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../api-pulseecho-data/">
      
      
        <link rel="next" href="../api-pulseecho-simulations/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>Pulse-echo processing - Pyintegrity documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pulse-echo-processing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Pyintegrity documentation" class="md-header__button md-logo" aria-label="Pyintegrity documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pyintegrity documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pulse-echo processing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pyintegrity documentation" class="md-nav__button md-logo" aria-label="Pyintegrity documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Pyintegrity documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fundamentals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-pulseecho-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse-echo data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pulse-echo processing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pulse-echo processing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.result.ProcessingResult" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#w2w1-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      W2/W1 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="W2/W1 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result" class="md-nav__link">
    <span class="md-ellipsis">
      W2W1Result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="W2W1Result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result.calculate_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_impedance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result.calibrate_w2w1" class="md-nav__link">
    <span class="md-ellipsis">
      calibrate_w2w1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.process_w2w1" class="md-nav__link">
    <span class="md-ellipsis">
      process_w2w1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.w2w1_to_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      w2w1_to_impedance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t3-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      T3 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="T3 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result" class="md-nav__link">
    <span class="md-ellipsis">
      T3result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="T3result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result.calculate_thickness_fres" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness_fres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result.derive_impedance_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      derive_impedance_thickness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.PreStep_processing" class="md-nav__link">
    <span class="md-ellipsis">
      PreStep_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_band" class="md-nav__link">
    <span class="md-ellipsis">
      T3_band
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_band1" class="md-nav__link">
    <span class="md-ellipsis">
      T3_band1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_model" class="md-nav__link">
    <span class="md-ellipsis">
      T3_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_model_group_delay" class="md-nav__link">
    <span class="md-ellipsis">
      T3_model_group_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_optimize" class="md-nav__link">
    <span class="md-ellipsis">
      T3_optimize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_planewavemodel" class="md-nav__link">
    <span class="md-ellipsis">
      T3_planewavemodel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin" class="md-nav__link">
    <span class="md-ellipsis">
      T3_tauF_tauMin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin1" class="md-nav__link">
    <span class="md-ellipsis">
      T3_tauF_tauMin1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.process_T3" class="md-nav__link">
    <span class="md-ellipsis">
      process_T3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abcd-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      ABCD algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ABCD algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult" class="md-nav__link">
    <span class="md-ellipsis">
      ABCDresult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ABCDresult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_impedance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.Mandal_plane_wave" class="md-nav__link">
    <span class="md-ellipsis">
      Mandal_plane_wave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.Mandal_processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mandal_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.process_abcd" class="md-nav__link">
    <span class="md-ellipsis">
      process_abcd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#l1-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      L1 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L1 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result" class="md-nav__link">
    <span class="md-ellipsis">
      L1result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L1result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result.calculate_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result.derive_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      derive_impedance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_model" class="md-nav__link">
    <span class="md-ellipsis">
      L1_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_optimize" class="md-nav__link">
    <span class="md-ellipsis">
      L1_optimize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_planewave" class="md-nav__link">
    <span class="md-ellipsis">
      L1_planewave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      L1_preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.find_resonance" class="md-nav__link">
    <span class="md-ellipsis">
      find_resonance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.hilbert1" class="md-nav__link">
    <span class="md-ellipsis">
      hilbert1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hilbert1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.hilbert1--httpsstackoverflowcomquestions56380536hilbert-transform-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      https://stackoverflow.com/questions/56380536/hilbert-transform-in-python
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.process_L1" class="md-nav__link">
    <span class="md-ellipsis">
      process_L1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-pulseecho-simulations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse-echo simulations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.result.ProcessingResult" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#w2w1-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      W2/W1 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="W2/W1 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result" class="md-nav__link">
    <span class="md-ellipsis">
      W2W1Result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="W2W1Result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result.calculate_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_impedance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result.calibrate_w2w1" class="md-nav__link">
    <span class="md-ellipsis">
      calibrate_w2w1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.process_w2w1" class="md-nav__link">
    <span class="md-ellipsis">
      process_w2w1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.w2w1.w2w1_to_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      w2w1_to_impedance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t3-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      T3 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="T3 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result" class="md-nav__link">
    <span class="md-ellipsis">
      T3result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="T3result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result.calculate_thickness_fres" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness_fres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3result.derive_impedance_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      derive_impedance_thickness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.PreStep_processing" class="md-nav__link">
    <span class="md-ellipsis">
      PreStep_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_band" class="md-nav__link">
    <span class="md-ellipsis">
      T3_band
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_band1" class="md-nav__link">
    <span class="md-ellipsis">
      T3_band1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_model" class="md-nav__link">
    <span class="md-ellipsis">
      T3_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_model_group_delay" class="md-nav__link">
    <span class="md-ellipsis">
      T3_model_group_delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_optimize" class="md-nav__link">
    <span class="md-ellipsis">
      T3_optimize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_planewavemodel" class="md-nav__link">
    <span class="md-ellipsis">
      T3_planewavemodel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin" class="md-nav__link">
    <span class="md-ellipsis">
      T3_tauF_tauMin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin1" class="md-nav__link">
    <span class="md-ellipsis">
      T3_tauF_tauMin1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.t3.process_T3" class="md-nav__link">
    <span class="md-ellipsis">
      process_T3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abcd-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      ABCD algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ABCD algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult" class="md-nav__link">
    <span class="md-ellipsis">
      ABCDresult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ABCDresult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_impedance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.Mandal_plane_wave" class="md-nav__link">
    <span class="md-ellipsis">
      Mandal_plane_wave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.Mandal_processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mandal_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.abcd.process_abcd" class="md-nav__link">
    <span class="md-ellipsis">
      process_abcd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#l1-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      L1 algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L1 algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result" class="md-nav__link">
    <span class="md-ellipsis">
      L1result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L1result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result.calculate_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_thickness
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1result.derive_impedance" class="md-nav__link">
    <span class="md-ellipsis">
      derive_impedance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_model" class="md-nav__link">
    <span class="md-ellipsis">
      L1_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_optimize" class="md-nav__link">
    <span class="md-ellipsis">
      L1_optimize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_planewave" class="md-nav__link">
    <span class="md-ellipsis">
      L1_planewave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.L1_preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      L1_preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.find_resonance" class="md-nav__link">
    <span class="md-ellipsis">
      find_resonance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.hilbert1" class="md-nav__link">
    <span class="md-ellipsis">
      hilbert1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hilbert1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.hilbert1--httpsstackoverflowcomquestions56380536hilbert-transform-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      https://stackoverflow.com/questions/56380536/hilbert-transform-in-python
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyintegrity.pulseecho.processing.l1.process_L1" class="md-nav__link">
    <span class="md-ellipsis">
      process_L1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="pulse-echo-processing">Pulse-echo processing</h1>
<p>This page describes the interface to the processing algorithms implemented as separate submodules in Pyintegrity:</p>
<ul>
<li><a href="./#w2w1-algorithm">W2/W1 algorithm</a></li>
<li><a href="./#t3-algorithm">T3 algorithm</a></li>
<li><a href="./#abcd-algorithm">ABCD algorithm</a></li>
<li><a href="./#l1-algorithm">L1 algorithm</a></li>
</ul>
<p>While the details of the algorithms are quite different, they all have a common interface. Each algorithm submodule includes a function <code>process_[algorithmname]</code> that accepts a <code>PulseEchoSeries</code> object (and in many cases other arguments as well) and returns an object of a <code>ProcessingResult</code> subclass:</p>


<div class="doc doc-object doc-class">



<h3 id="pyintegrity.pulseecho.processing.result.ProcessingResult" class="doc doc-heading">
          <code>pyintegrity.pulseecho.processing.result.ProcessingResult</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>Generic result container to be subclassed by containers for specific algorithms</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>impedance</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Impedance behind casing estimated by a processing algorithm</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>thickness</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Casing thickness estimated by a processing algorithm</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/pyintegrity/pulseecho/processing/result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProcessingResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic result container to be subclassed by containers for specific algorithms</span>

<span class="sd">    Args:</span>
<span class="sd">        impedance: Impedance behind casing estimated by a processing algorithm</span>
<span class="sd">        thickness: Casing thickness estimated by a processing algorithm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">impedance</span><span class="p">:</span> <span class="n">LogChannel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">thickness</span><span class="p">:</span> <span class="n">LogChannel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">impedance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div><h2 id="w2w1-algorithm">W2/W1 algorithm</h2>


<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Module for W2/W1 processing of pulse-echo waveforms. This processing algorithm was first proposed by Havira (1981) and
subsequently refined by later researchers. This module mainly follows the specification of Kimball (1992), but also uses
the conversion between W2/W1 values and impedance specified by Catala et al. (1987).</p>
<p>Furthermore, we have included an extension where W1 and W2 value may optionally be calculated from the waveform envelope
instead of the rectified waveform as specified in the literature. The additional computational load is marginal, and it
reduces random variations in W2.</p>
<p>Note that the W2/W1 algorithm only provides an estimate of the impedance of the material behind the casing. It does not
provide an estimate of the casing thickness.</p>
<p>References:</p>
<ul>
<li>Havira, R.M. (1981): “Method and apparatus for acoustically investigating a casing and cement bond in a borehole”.
  US Patent 4,255,798.</li>
<li>Catala, G., Stowe, I., Henry, D. (1987): “Method for evaluating the quality of cement surrounding the casing of a
  borehole”. US Patent 4,703,427.</li>
<li>Kimball, C. V. (1992): “Improved processing for oil well cement evaluation—A study with theoretical and laboratory
  data”. In IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control vol. 39, no.1.</li>
</ul>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pyintegrity.pulseecho.processing.w2w1.W2W1Result" class="doc doc-heading">
          <code>pyintegrity.pulseecho.processing.w2w1.W2W1Result</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.result.ProcessingResult" href="#pyintegrity.pulseecho.processing.result.ProcessingResult">ProcessingResult</a></code></p>

  
      <p>Result container for W2/W1 processing</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>w2w1</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw W2/W1 values from processing, with no calibration applied</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="pyintegrity.pulseecho.processing.w2w1.W2W1Result.w2w1">w2w1</span></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw W2/W1 for every waveform</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="pyintegrity.pulseecho.processing.w2w1.W2W1Result.w2w1_fp">w2w1_fp</span></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Free-pipe value of W2/W1</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="pyintegrity.pulseecho.processing.w2w1.W2W1Result.w2w1_cal">w2w1_cal</span></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw W2/W1 normalized by free-pipe value of W2/W1</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="pyintegrity.pulseecho.processing.w2w1.W2W1Result.impedance_fp">impedance_fp</span></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specified free-pipe impedance</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/pyintegrity/pulseecho/processing/w2w1.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">W2W1Result</span><span class="p">(</span><span class="n">ProcessingResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result container for W2/W1 processing</span>

<span class="sd">    Args:</span>
<span class="sd">        w2w1: Raw W2/W1 values from processing, with no calibration applied</span>

<span class="sd">    Attributes:</span>
<span class="sd">        w2w1 (LogChannel): Raw W2/W1 for every waveform</span>
<span class="sd">        w2w1_fp (Quantity | None): Free-pipe value of W2/W1</span>
<span class="sd">        w2w1_cal (LogChannel | None): Raw W2/W1 normalized by free-pipe value of W2/W1</span>
<span class="sd">        impedance_fp (Quantity | None): Specified free-pipe impedance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w2w1</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>                          <span class="c1"># Initializes impedance behind casing and casing thickness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span> <span class="o">=</span> <span class="n">w2w1</span>                            <span class="c1"># Raw W2/W1 for every waveform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>        <span class="c1"># Free-pipe value of W2/W1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span><span class="p">:</span> <span class="n">LogChannel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># Raw W2/W1 divided by free-pipe value of W2/W1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># Specified free-pipe impedance</span>

    <span class="k">def</span> <span class="nf">calibrate_w2w1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">w2w1_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">interval_fp</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calibrate W2/W1 values by a free-pipe value which is provided or calculated from a provided depth interval</span>

<span class="sd">        Args:</span>
<span class="sd">            w2w1_fp: Provided free-pipe W2/W1 value</span>
<span class="sd">            interval_fp: Free pipe interval to calculate W2/W1 value from if w2w1_fp is not specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">w2w1_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">interval_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either w2w1_fp or interval_fp must be not-None&#39;</span><span class="p">)</span>
            <span class="c1"># Take the median W2/W1 value inside the free-pipe interval. (Median is robust to casing collar outliers.)</span>
            <span class="n">w2w1_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">interval_fp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interval_fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_fp</span> <span class="o">=</span> <span class="n">w2w1_fp</span>
        <span class="n">w2w1_cal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">w2w1_cal</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">w2w1_fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span> <span class="o">=</span> <span class="n">w2w1_cal</span>

    <span class="k">def</span> <span class="nf">calculate_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                            <span class="n">impedance_fp</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                            <span class="n">factor_a</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">factor_b</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts normalized W2/W1 values into impedance values</span>

<span class="sd">        Args:</span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">            impedance_fp: Assumed free-pipe impedance value</span>
<span class="sd">            factor_a: Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</span>
<span class="sd">            factor_b: Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">impedance_fp</span> <span class="o">=</span> <span class="n">impedance_fp</span>
        <span class="n">impedance</span> <span class="o">=</span> <span class="n">w2w1_to_impedance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="p">,</span> <span class="n">factor_a</span><span class="p">,</span> <span class="n">factor_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">impedance</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.w2w1.W2W1Result.calculate_impedance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="p">,</span> <span class="n">factor_a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor_b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Converts normalized W2/W1 values into impedance values</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>impedance_fp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Assumed free-pipe impedance value</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>factor_a</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>factor_b</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/w2w1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                        <span class="n">impedance_fp</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                        <span class="n">factor_a</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">factor_b</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts normalized W2/W1 values into impedance values</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        impedance_fp: Assumed free-pipe impedance value</span>
<span class="sd">        factor_a: Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</span>
<span class="sd">        factor_b: Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">impedance_fp</span> <span class="o">=</span> <span class="n">impedance_fp</span>
    <span class="n">impedance</span> <span class="o">=</span> <span class="n">w2w1_to_impedance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="p">,</span> <span class="n">factor_a</span><span class="p">,</span> <span class="n">factor_b</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">impedance</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.w2w1.W2W1Result.calibrate_w2w1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calibrate_w2w1</span><span class="p">(</span><span class="n">w2w1_fp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval_fp</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calibrate W2/W1 values by a free-pipe value which is provided or calculated from a provided depth interval</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>w2w1_fp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Provided free-pipe W2/W1 value</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>interval_fp</code></td>
          <td>
                <code>tuple[float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Free pipe interval to calculate W2/W1 value from if w2w1_fp is not specified</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/w2w1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calibrate_w2w1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">w2w1_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">interval_fp</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calibrate W2/W1 values by a free-pipe value which is provided or calculated from a provided depth interval</span>

<span class="sd">    Args:</span>
<span class="sd">        w2w1_fp: Provided free-pipe W2/W1 value</span>
<span class="sd">        interval_fp: Free pipe interval to calculate W2/W1 value from if w2w1_fp is not specified</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">w2w1_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interval_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either w2w1_fp or interval_fp must be not-None&#39;</span><span class="p">)</span>
        <span class="c1"># Take the median W2/W1 value inside the free-pipe interval. (Median is robust to casing collar outliers.)</span>
        <span class="n">w2w1_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">interval_fp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interval_fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_fp</span> <span class="o">=</span> <span class="n">w2w1_fp</span>
    <span class="n">w2w1_cal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">w2w1_cal</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">w2w1_fp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">w2w1_cal</span> <span class="o">=</span> <span class="n">w2w1_cal</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.w2w1.process_w2w1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">process_w2w1</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">use_envelope</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">w2w1_fp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval_fp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor_a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor_b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform W2/W1 on input waveform data</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>use_envelope</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to perform W2/W1 processing on the waveform envelope or the rectified waveform</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>w2w1_fp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional free-pipe W2/W1 value to use for normalization</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>interval_fp</code></td>
          <td>
                <code>tuple[float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional free-pipe interval to calculate <code>w2w1_fp</code> from if it is not specified</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>impedance_fp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reference impedance value in the free-pipe interval</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>factor_a</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>factor_b</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.w2w1.W2W1Result" href="#pyintegrity.pulseecho.processing.w2w1.W2W1Result">W2W1Result</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A <code>W2W1Result</code> object with the processing results</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/w2w1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_w2w1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                 <span class="n">use_envelope</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">w2w1_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">interval_fp</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">impedance_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">factor_a</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">factor_b</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">W2W1Result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform W2/W1 on input waveform data</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>
<span class="sd">        use_envelope: Whether to perform W2/W1 processing on the waveform envelope or the rectified waveform</span>
<span class="sd">        w2w1_fp: Optional free-pipe W2/W1 value to use for normalization</span>
<span class="sd">        interval_fp: Optional free-pipe interval to calculate `w2w1_fp` from if it is not specified</span>
<span class="sd">        impedance_fp: The reference impedance value in the free-pipe interval</span>
<span class="sd">        factor_a: Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</span>
<span class="sd">        factor_b: Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</span>

<span class="sd">    Returns:</span>
<span class="sd">        A `W2W1Result` object with the processing results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>   <span class="c1"># depth-angle-time array of waveforms</span>
    <span class="k">if</span> <span class="n">use_envelope</span><span class="p">:</span>
        <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveforms</span><span class="p">)</span>

    <span class="n">w1s</span><span class="p">,</span> <span class="n">k_w1s</span> <span class="o">=</span> <span class="n">_get_w1</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">waveforms</span><span class="p">)</span>
    <span class="n">last_zero_crossings</span> <span class="o">=</span> <span class="n">_previous_zero_crossing</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">k_w1s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#pylint: disable=typecheck</span>
    <span class="n">w2s</span> <span class="o">=</span> <span class="n">_get_w2</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">last_zero_crossings</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span>

    <span class="n">w2w1</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">w2s</span><span class="o">/</span><span class="n">w1s</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">W2W1Result</span><span class="p">(</span><span class="n">w2w1</span><span class="p">)</span>

    <span class="c1"># Normalize W2/W1 against its free-pipe value</span>
    <span class="k">if</span> <span class="n">w2w1_fp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">interval_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># Not possible to calculate free-pipe W2/W1 value</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># W2/W1 calculation cannot proceed any further</span>
    <span class="n">result</span><span class="o">.</span><span class="n">calibrate_w2w1</span><span class="p">(</span><span class="n">w2w1_fp</span><span class="o">=</span><span class="n">w2w1_fp</span><span class="p">,</span> <span class="n">interval_fp</span><span class="o">=</span><span class="n">interval_fp</span><span class="p">)</span>

    <span class="c1"># Calculate impedance from normalized W2/W1 values</span>
    <span class="k">if</span> <span class="n">impedance_fp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># No specified free-pipe impedance</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># W2/W1 calculation cannot proceed any further</span>
    <span class="n">result</span><span class="o">.</span><span class="n">calculate_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="p">,</span> <span class="n">factor_a</span><span class="p">,</span> <span class="n">factor_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.w2w1.w2w1_to_impedance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">w2w1</span><span class="o">.</span><span class="n">w2w1_to_impedance</span><span class="p">(</span><span class="n">w2w1_cal</span><span class="p">,</span> <span class="n">casing_thickness</span><span class="p">,</span> <span class="n">impedance_fp</span><span class="o">=</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;MRayl&#39;</span><span class="p">),</span> <span class="n">factor_a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor_b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert from normalized W2/W1 values to impedance following Catala et al. (1987)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>w2w1_cal</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a> | <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(W2/W1) / (W2/W1)_fp values, (W2/W1)_fp being the assumed free-pipe value of W2/W1</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>casing_thickness</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The thickness of the logged casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>impedance_fp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The assumed impedance beyond the casing in a free-pipe section</p>
            </div>
          </td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a>(1.5, &#39;MRayl&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>factor_a</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>factor_b</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/w2w1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">w2w1_to_impedance</span><span class="p">(</span><span class="n">w2w1_cal</span><span class="p">:</span> <span class="n">LogChannel</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">casing_thickness</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                      <span class="n">impedance_fp</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;MRayl&#39;</span><span class="p">),</span>
                      <span class="n">factor_a</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">factor_b</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Quantity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert from normalized W2/W1 values to impedance following Catala et al. (1987)</span>

<span class="sd">    Args:</span>
<span class="sd">        w2w1_cal: (W2/W1) / (W2/W1)_fp values, (W2/W1)_fp being the assumed free-pipe value of W2/W1</span>
<span class="sd">        casing_thickness: The thickness of the logged casing</span>
<span class="sd">        impedance_fp: The assumed impedance beyond the casing in a free-pipe section</span>
<span class="sd">        factor_a: Factor for casing thickness and logarithmic W2/W1; corresponds to A in Catala et al. (1987)</span>
<span class="sd">        factor_b: Factor for logarithmic W2/W1; corresponds to B in Catala et al. (1987)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">factor_a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">factor_a</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;kg/mm^3/s&#39;</span><span class="p">)</span>   <span class="c1"># Default value from Catala et al. (1987)</span>
    <span class="k">if</span> <span class="n">factor_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">factor_b</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;kg/mm^2/s&#39;</span><span class="p">)</span>   <span class="c1"># Default value from Catala et al. (1987)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w2w1_cal</span><span class="p">,</span> <span class="n">LogChannel</span><span class="p">):</span>
        <span class="n">w2w1_cal</span> <span class="o">=</span> <span class="n">w2w1_cal</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">factor_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">factor_a</span> <span class="o">*</span> <span class="n">casing_thickness</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">factor_b</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;MRayl&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">impedance_fp</span> <span class="o">-</span> <span class="n">factor_c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">w2w1_cal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="t3-algorithm">T<sup>3</sup> algorithm</h2>


<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Module for T3 processing following the description in Hayman (1991) and
Wright (1993).
The algorithm is based on the derivation of the group delay curve to derive 
thickness and impedance</p>
<p>Hayman, A., Hutin, R., Wright, P., 1991. High-resolution cementation
and corrosion imaging by ultrasound, in: SPWLA 32th Annual Logging
Symposium, p. 25.</p>
<p>Wright, P., 1993. Method and apparatus for the acoustic investigation of a
casing cemented in a borehole. US Patent No. 5,216,638.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pyintegrity.pulseecho.processing.t3.T3result" class="doc doc-heading">
          <code>pyintegrity.pulseecho.processing.t3.T3result</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.result.ProcessingResult" href="#pyintegrity.pulseecho.processing.result.ProcessingResult">ProcessingResult</a></code></p>

  
      <p>Result container for T3 processing</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>band</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth of group delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fres</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency derived from group-delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Spec_firstpulse</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the spectrum from the first pulse used in the convolution with the 1D model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">T3result</span><span class="p">(</span><span class="n">ProcessingResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result container for T3 processing</span>

<span class="sd">    Args:</span>
<span class="sd">        band: bandwidth of group delay minimum</span>
<span class="sd">        fres: resonance frequency derived from group-delay minimum</span>
<span class="sd">        Spec_firstpulse: the spectrum from the first pulse used in the convolution with the 1D model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                    <span class="n">fres</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                    <span class="n">Spec_firstpulse</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>                          <span class="c1"># Initializes impedance behind casing and casing thickness</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">band</span><span class="o">=</span> <span class="n">band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">=</span> <span class="n">fres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">=</span> <span class="n">Spec_firstpulse</span>

    <span class="k">def</span> <span class="nf">derive_impedance_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                          <span class="n">T3band_meas</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                          <span class="n">T3freq</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                          <span class="n">f_search</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                          <span class="n">indT_S0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">indT_S1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">indT_N0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">indT_N1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Derive impedance using group delay parameters through optimization algorithm </span>

<span class="sd">        Args: </span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">            T3band_meas: bandwidth derived form measured data   </span>
<span class="sd">            T3freq: frequency vector</span>
<span class="sd">            f_search: window limits for search area</span>
<span class="sd">            indT_S0: signal window start</span>
<span class="sd">            indT_S1: signal window end</span>
<span class="sd">            indT_N0: normalization window start</span>
<span class="sd">            indT_N1: normalisation window end</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">fres_meas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">T3N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">f_exp</span><span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
        <span class="c1"># Optimization to derive outer-material impedance and pipe thickness</span>
        <span class="n">d</span><span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">fres_meas</span><span class="p">)</span>  <span class="c1"># derive thickness from group delay resonance</span>

        <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">]</span><span class="o">=</span><span class="n">T3band_meas</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">Z_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
        <span class="n">d_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">initial_val</span> <span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>

                    <span class="n">indT_S</span><span class="o">=</span><span class="p">[</span><span class="n">indT_S0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">indT_S1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>
                    <span class="n">indT_N</span><span class="o">=</span><span class="p">[</span><span class="n">indT_N0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">indT_N1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">argsH</span><span class="o">=</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                               <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">,</span><span class="n">T3N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:],</span>
                               <span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">T3freq</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                               <span class="n">fres_meas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                               <span class="n">f_search</span><span class="p">,</span>
                               <span class="n">T3band_meas</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">final_T3</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">T3_optimize</span><span class="p">,</span> <span class="n">initial_val</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">argsH</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                        <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_T3</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
                        <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_T3</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">except</span><span class="p">:</span>   <span class="c1"># FIXME: Specify exception type   # pylint: disable=bare-except</span>
                        <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Z_res</span><span class="p">,</span><span class="s1">&#39;MRayl&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">d_res</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_thickness_fres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">        Args: </span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.t3.T3result.calculate_thickness_fres" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_thickness_fres</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculate thickness from resonance frequency</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_thickness_fres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">    Args: </span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.t3.T3result.derive_impedance_thickness" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">derive_impedance_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">T3band_meas</span><span class="p">,</span> <span class="n">T3freq</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">indT_S0</span><span class="p">,</span> <span class="n">indT_S1</span><span class="p">,</span> <span class="n">indT_N0</span><span class="p">,</span> <span class="n">indT_N1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Derive impedance using group delay parameters through optimization algorithm </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3band_meas</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth derived form measured data   </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3freq</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_search</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>window limits for search area</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S0</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>signal window start</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S1</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>signal window end</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_N0</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>normalization window start</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_N1</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>normalisation window end</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">derive_impedance_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                      <span class="n">T3band_meas</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                      <span class="n">T3freq</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                      <span class="n">f_search</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                      <span class="n">indT_S0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">indT_S1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">indT_N0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">indT_N1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive impedance using group delay parameters through optimization algorithm </span>

<span class="sd">    Args: </span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        T3band_meas: bandwidth derived form measured data   </span>
<span class="sd">        T3freq: frequency vector</span>
<span class="sd">        f_search: window limits for search area</span>
<span class="sd">        indT_S0: signal window start</span>
<span class="sd">        indT_S1: signal window end</span>
<span class="sd">        indT_N0: normalization window start</span>
<span class="sd">        indT_N1: normalisation window end</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">fres_meas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">T3N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">f_exp</span><span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
    <span class="c1"># Optimization to derive outer-material impedance and pipe thickness</span>
    <span class="n">d</span><span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">fres_meas</span><span class="p">)</span>  <span class="c1"># derive thickness from group delay resonance</span>

    <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">]</span><span class="o">=</span><span class="n">T3band_meas</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">Z_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
    <span class="n">d_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">initial_val</span> <span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>

                <span class="n">indT_S</span><span class="o">=</span><span class="p">[</span><span class="n">indT_S0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">indT_S1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>
                <span class="n">indT_N</span><span class="o">=</span><span class="p">[</span><span class="n">indT_N0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">indT_N1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">argsH</span><span class="o">=</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                           <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">,</span><span class="n">T3N</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:],</span>
                           <span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">T3freq</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">fres_meas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                           <span class="n">f_search</span><span class="p">,</span>
                           <span class="n">T3band_meas</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">final_T3</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">T3_optimize</span><span class="p">,</span> <span class="n">initial_val</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">argsH</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_T3</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
                    <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_T3</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">except</span><span class="p">:</span>   <span class="c1"># FIXME: Specify exception type   # pylint: disable=bare-except</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">d_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Z_res</span><span class="p">,</span><span class="s1">&#39;MRayl&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">d_res</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.PreStep_processing" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">PreStep_processing</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">lim_win</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Preprocessing of the data to derive group delay curve, resonance frequency, group delay minimum and         bandwidth of minimum</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lim_win</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>window limits in periods for normalization and signal window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>scale</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>scale of frequency resolution</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>T3freq</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>T3taugSN</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay curve</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>T3N</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>normalization spectrum, spectrum of the first pulse</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>indT_S0</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>start signal window</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>indT_S1</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>stop signal window</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>indT_N0</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>start normalization window</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>indT_N1</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>stop normalization window</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">PreStep_processing</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span> <span class="n">lim_win</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Preprocessing of the data to derive group delay curve, resonance frequency, group delay minimum and \</span>
<span class="sd">        bandwidth of minimum</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>
<span class="sd">        lim_win: window limits in periods for normalization and signal window</span>
<span class="sd">        scale: scale of frequency resolution</span>

<span class="sd">    Returns:</span>
<span class="sd">        T3freq: Frequency vector corresponding to the spectrum</span>
<span class="sd">        T3taugSN: group delay curve</span>
<span class="sd">        T3N: normalization spectrum, spectrum of the first pulse</span>
<span class="sd">        indT_S0: start signal window</span>
<span class="sd">        indT_S1: stop signal window</span>
<span class="sd">        indT_N0: start normalization window</span>
<span class="sd">        indT_N1: stop normalization window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">N_per</span><span class="o">=</span><span class="n">lim_win</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">S_per</span><span class="o">=</span><span class="n">lim_win</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">### Step1 ###</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>
    <span class="n">f_exp</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span>


    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">waveforms</span><span class="p">))</span>
    <span class="n">env</span><span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">T3t_max</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">find_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">env</span><span class="p">)</span>
    <span class="n">t_help</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="p">),</span> <span class="n">t</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

    <span class="c1">### Step2,3 ###</span>
    <span class="c1"># find window length for normalization and signal window</span>
    <span class="n">per</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">T3t_N</span> <span class="o">=</span> <span class="p">[</span><span class="n">T3t_max</span><span class="o">-</span><span class="p">(</span><span class="n">N_per</span><span class="o">*</span><span class="n">per</span><span class="p">),</span> <span class="n">T3t_max</span><span class="o">+</span><span class="p">(</span><span class="n">N_per</span><span class="o">*</span><span class="n">per</span><span class="p">)]</span>
    <span class="n">indT_N</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_help</span> <span class="o">-</span> <span class="n">T3t_N</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>   <span class="c1"># First sample index of the range</span>
              <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_help</span> <span class="o">-</span> <span class="n">T3t_N</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">indT_N0</span><span class="o">=</span><span class="n">indT_N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Nfft</span>
    <span class="n">indT_N1</span><span class="o">=</span><span class="n">indT_N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Nfft</span>

    <span class="n">T3t_S</span> <span class="o">=</span> <span class="p">[</span><span class="n">T3t_max</span><span class="o">-</span><span class="p">(</span><span class="n">S_per</span><span class="o">*</span><span class="n">per</span><span class="p">),</span> <span class="n">T3t_max</span><span class="o">+</span><span class="p">(</span><span class="n">S_per</span><span class="o">*</span><span class="n">per</span><span class="p">)]</span>
    <span class="n">indT_S</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_help</span> <span class="o">-</span> <span class="n">T3t_S</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>   <span class="c1"># First sample index of the range</span>
              <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_help</span> <span class="o">-</span> <span class="n">T3t_S</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">indT_S0</span><span class="o">=</span><span class="n">indT_S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Nfft</span>
    <span class="n">indT_S1</span><span class="o">=</span><span class="n">indT_S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Nfft</span>

    <span class="c1"># Upscaling </span>
    <span class="n">NfftS</span><span class="o">=</span><span class="n">Nfft</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">waveformsScale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">NfftS</span><span class="p">])</span>
    <span class="n">waveformsScale</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span>

    <span class="n">NfftS2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">NfftS</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">T3N</span><span class="o">=</span><span class="n">_nom_Spec</span><span class="p">(</span><span class="n">indT_N0</span><span class="p">,</span><span class="n">indT_N1</span><span class="p">,</span><span class="n">NfftS</span><span class="p">,</span><span class="n">waveformsScale</span><span class="p">)[:,:,:</span><span class="n">NfftS2</span><span class="p">]</span>   <span class="c1"># pylint: disable=typecheck</span>
    <span class="n">T3S</span><span class="o">=</span><span class="n">_sig_Spec</span><span class="p">(</span><span class="n">indT_S0</span><span class="p">,</span><span class="n">indT_S1</span><span class="p">,</span><span class="n">indT_N0</span><span class="p">,</span><span class="n">NfftS</span><span class="p">,</span><span class="n">waveformsScale</span><span class="p">)[:,:,:</span><span class="n">NfftS2</span><span class="p">]</span>   <span class="c1"># pylint: disable=typecheck</span>

    <span class="n">T3freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NfftS2</span><span class="p">)</span><span class="o">/</span><span class="n">NfftS</span><span class="o">/</span><span class="p">((</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">df</span><span class="o">=</span><span class="n">T3freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">T3freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">T3SN</span> <span class="o">=</span> <span class="n">T3S</span><span class="o">/</span><span class="n">T3N</span>
    <span class="n">phirSN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">T3SN</span><span class="p">))</span>

    <span class="n">T3taugSN</span> <span class="o">=</span> <span class="p">(</span><span class="n">phirSN</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">::]</span><span class="o">-</span><span class="n">phirSN</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="p">)</span> 

    <span class="k">return</span> <span class="n">T3freq</span><span class="p">,</span><span class="n">T3taugSN</span><span class="p">,</span> <span class="n">T3N</span><span class="p">,</span> <span class="n">indT_S0</span><span class="p">,</span> <span class="n">indT_S1</span><span class="p">,</span> <span class="n">indT_N0</span><span class="p">,</span> <span class="n">indT_N1</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_band" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_band</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tauF</span><span class="p">,</span> <span class="n">taumin</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculating the bandwidth og the group delay minimum</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tauF</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency of group delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taumin</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3taugSN</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay curve</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>band</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth of group delay minimum</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_band</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span><span class="n">tauF</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span><span class="n">taumin</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span><span class="n">T3taugSN</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Quantity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculating the bandwidth og the group delay minimum</span>

<span class="sd">    Args:</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        tauF: resonance frequency of group delay minimum</span>
<span class="sd">        taumin: group delay minimum</span>
<span class="sd">        T3taugSN: group delay curve</span>

<span class="sd">    Returns:</span>
<span class="sd">        band: bandwidth of group delay minimum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f_fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">tauF</span><span class="o">.</span><span class="n">magnitude</span><span class="o">-</span><span class="n">tauF</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">tauF</span><span class="o">.</span><span class="n">magnitude</span><span class="o">+</span><span class="n">tauF</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">band</span><span class="o">=</span><span class="n">_get_band</span><span class="p">(</span><span class="n">T3taugSN</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">taumin</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">fstart</span><span class="p">,</span> <span class="n">fstop</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>   <span class="c1"># pylint: disable=typecheck</span>
    <span class="n">band</span><span class="o">=</span><span class="n">Quantity</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">band</span>   
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_band1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_band1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tauF</span><span class="p">,</span> <span class="n">taumin</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculating the bandwidth and the group delay minimum for one trace</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tauF</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency of group delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taumin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3taugSN</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay curve</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>band</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth of group delay minimum</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">T3_band1</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">,</span><span class="n">tauF</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taumin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculating the bandwidth and the group delay minimum for one trace</span>

<span class="sd">    Args:</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        tauF: resonance frequency of group delay minimum</span>
<span class="sd">        taumin: group delay minimum</span>
<span class="sd">        T3taugSN: group delay curve</span>

<span class="sd">    Returns:</span>
<span class="sd">        band: bandwidth of group delay minimum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f_fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">tauF</span><span class="o">-</span><span class="n">tauF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">tauF</span><span class="o">+</span><span class="n">tauF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">fstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">fstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">taumin</span><span class="p">):</span>
        <span class="n">band</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fstart</span><span class="p">,</span><span class="n">fstop</span><span class="p">)</span>
        <span class="n">peak40</span> <span class="o">=</span> <span class="n">taumin</span> <span class="o">/</span><span class="mi">100</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 40 % from maximum</span>
        <span class="n">taudiff</span><span class="o">=-</span><span class="n">T3taugSN</span><span class="p">[</span><span class="n">i_range</span><span class="p">]</span><span class="o">-</span><span class="n">peak40</span>
        <span class="n">taucr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taucr</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">band</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">taucrU</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">taucrU</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">taucr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">*</span><span class="mi">100</span>
                                  <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                                  <span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">taucrU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">taucr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">*</span><span class="mi">100</span>
                                  <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">taudiff</span><span class="p">[</span><span class="n">taucr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                                  <span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">band</span> <span class="o">=</span> <span class="p">(</span><span class="n">taucrU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">taucrU</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">df</span> 
    <span class="k">return</span> <span class="n">band</span>  
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_model" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_model</span><span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_search</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deriving modelled group delay curve and determining, resonance frequency, minimum value and bandwidth from the         modelled data</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>in_val</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of input parameters to derive impedance and thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner material</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>v_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for signal window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_N</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for normalization window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3N_w</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>spectrum of initial reflection</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_search</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search window for group delay minimum as plus-minus from</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tauF_mod</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency of group delay minimum from modelled data</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>band_mod</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth of group delay minimum from modelled data</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_model</span><span class="p">(</span><span class="n">in_val</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
             <span class="n">f0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">f_search</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deriving modelled group delay curve and determining, resonance frequency, minimum value and bandwidth from the \</span>
<span class="sd">        modelled data</span>

<span class="sd">    Args:</span>
<span class="sd">        in_val: list of input parameters to derive impedance and thickness</span>
<span class="sd">        Zcas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner material</span>
<span class="sd">        v_cas: P-wave speed of casing</span>
<span class="sd">        indT_S: list of start and stop for signal window</span>
<span class="sd">        indT_N: list of start and stop for normalization window</span>
<span class="sd">        T3N_w: spectrum of initial reflection</span>
<span class="sd">        f0: expected resonance frequency</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        f_search: search window for group delay minimum as plus-minus from</span>

<span class="sd">    Returns:</span>
<span class="sd">        tauF_mod: frequency of group delay minimum from modelled data</span>
<span class="sd">        band_mod: bandwidth of group delay minimum from modelled data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Zfo</span><span class="o">=</span><span class="n">in_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
    <span class="n">d_cas</span><span class="o">=</span><span class="n">in_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># plane wave model estimation of reflection coefficent</span>
    <span class="n">ref_coeff</span> <span class="o">=</span> <span class="n">T3_planewavemodel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">d_cas</span><span class="p">,</span><span class="n">v_cas</span><span class="p">,</span><span class="n">Zcas</span><span class="p">,</span><span class="n">Zin</span><span class="p">,</span><span class="n">Zfo</span><span class="p">)</span>
    <span class="c1"># calculation of group delay</span>
    <span class="n">T3taugSN_mod</span> <span class="o">=</span> <span class="n">T3_model_group_delay</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ref_coeff</span><span class="p">,</span><span class="n">T3N_w</span><span class="p">,</span><span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">)</span>
    <span class="c1"># derive resonance frequency and group delay minimum</span>
    <span class="n">tauF_mod</span><span class="p">,</span><span class="n">taumin_mod</span><span class="o">=</span><span class="n">T3_tauF_tauMin1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">T3taugSN_mod</span><span class="p">)</span>

    <span class="c1"># derive band from model data</span>
    <span class="n">band_mod</span><span class="o">=</span><span class="n">T3_band1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tauF_mod</span><span class="p">,</span><span class="n">taumin_mod</span><span class="p">,</span> <span class="n">T3taugSN_mod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tauF_mod</span><span class="p">,</span><span class="n">band_mod</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_model_group_delay" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_model_group_delay</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ref_coeff</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deriving group delay from modelled plane wave reflection coefficient</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_coeff</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>1D modelled reflection coefficient</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3N_w</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>spectrum of initial reflection</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for signal window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_N</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for normalization window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>T3taugSN_mod</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>modelled group delay</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_model_group_delay</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ref_coeff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">:</span> <span class="nb">list</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deriving group delay from modelled plane wave reflection coefficient</span>

<span class="sd">    Args:        </span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        ref_coeff: 1D modelled reflection coefficient</span>
<span class="sd">        T3N_w: spectrum of initial reflection</span>
<span class="sd">        indT_S: list of start and stop for signal window</span>
<span class="sd">        indT_N: list of start and stop for normalization window</span>

<span class="sd">    Returns:</span>
<span class="sd">        T3taugSN_mod: modelled group delay</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S_ham</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">indT_S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">indT_S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Nfft</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">TSN</span><span class="o">=</span><span class="n">_step2</span><span class="p">(</span><span class="n">ref_coeff</span><span class="p">,</span><span class="n">T3N_w</span><span class="p">,</span><span class="n">Nfft</span><span class="p">,</span><span class="n">S_ham</span><span class="p">,</span><span class="n">indT_S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">indT_S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">indT_N</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">step3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nfft</span><span class="p">)</span>
    <span class="n">step3</span> <span class="o">=</span> <span class="n">_angle_unwrap1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">TSN</span><span class="p">))</span>

    <span class="n">T3taugSN_mod</span> <span class="o">=</span> <span class="p">(</span><span class="n">step3</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span><span class="o">-</span><span class="n">step3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">T3taugSN_mod</span>    
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_optimize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_optimize</span><span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">T3f0_meas</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">T3band_meas</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Algorithm that calls model to optimize error between real data and model data to find the best estimate for         impedance and thickness</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>in_val</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of input parameters to derive impedance and thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner material</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>v_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for signal window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_N</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for normalization window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indT_S</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of start and stop for signal window</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3f0_meas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency derived from measured data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_search</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search window for group delay minimum as plus-minus from </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3band_meas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bandwidth of group-delay minimum of measured data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>error between resonance frequency and group delay minimum of measured and modelled data</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_optimize</span><span class="p">(</span><span class="n">in_val</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">:</span> <span class="nb">float</span> <span class="p">,</span><span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">indT_S</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">T3N_w</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                <span class="n">f0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">T3f0_meas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f_search</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">T3band_meas</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Algorithm that calls model to optimize error between real data and model data to find the best estimate for \</span>
<span class="sd">        impedance and thickness</span>

<span class="sd">    Args:</span>
<span class="sd">        in_val: list of input parameters to derive impedance and thickness</span>
<span class="sd">        Zcas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner material</span>
<span class="sd">        v_cas: P-wave speed of casing</span>
<span class="sd">        indT_S: list of start and stop for signal window</span>
<span class="sd">        indT_N: list of start and stop for normalization window</span>
<span class="sd">        indT_S: list of start and stop for signal window</span>
<span class="sd">        f0: expected resonance frequency</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        T3f0_meas: resonance frequency derived from measured data</span>
<span class="sd">        f_search: search window for group delay minimum as plus-minus from </span>
<span class="sd">        T3band_meas: bandwidth of group-delay minimum of measured data</span>

<span class="sd">    Returns:</span>
<span class="sd">        error between resonance frequency and group delay minimum of measured and modelled data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T3f0_model</span><span class="p">,</span><span class="n">T3band_model</span><span class="o">=</span><span class="n">T3_model</span><span class="p">(</span><span class="n">in_val</span><span class="p">,</span><span class="n">Zcas</span><span class="p">,</span><span class="n">Zin</span><span class="p">,</span><span class="n">v_cas</span><span class="p">,</span><span class="n">indT_S</span><span class="p">,</span> <span class="n">indT_N</span><span class="p">,</span><span class="n">T3N_w</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f_search</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">((</span><span class="n">T3f0_model</span><span class="o">-</span><span class="n">T3f0_meas</span><span class="p">)</span><span class="o">/</span><span class="n">T3f0_meas</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> \
            <span class="o">+</span> <span class="p">((</span><span class="n">T3band_model</span><span class="o">/</span><span class="n">T3f0_model</span><span class="o">-</span><span class="n">T3band_meas</span><span class="o">/</span><span class="n">T3f0_meas</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T3band_meas</span><span class="o">/</span><span class="n">T3f0_meas</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> \
            <span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_planewavemodel" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_planewavemodel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">d_cas</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">Zfo</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Reflection coefficient from 1D model</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>d_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>derived pipe thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>v_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner material</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zfo</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>outer material impedance guess</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ref_coeff</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>1D modelled reflection coefficient</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">T3_planewavemodel</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">d_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zcas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zfo</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>  
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Reflection coefficient from 1D model</span>

<span class="sd">    Args:        </span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        d_cas: derived pipe thickness</span>
<span class="sd">        v_cas: P-wave speed of casing</span>
<span class="sd">        Zcas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner material</span>
<span class="sd">        Zfo: outer material impedance guess</span>

<span class="sd">    Returns:</span>
<span class="sd">        ref_coeff: 1D modelled reflection coefficient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ckd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="n">v_cas</span> <span class="o">*</span><span class="n">d_cas</span><span class="p">)</span>
    <span class="n">skd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="n">v_cas</span> <span class="o">*</span><span class="n">d_cas</span><span class="p">)</span>
    <span class="n">ref_coeff</span> <span class="o">=</span> <span class="p">(</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Zin</span><span class="o">/</span><span class="n">Zfo</span><span class="p">)</span> <span class="o">*</span> <span class="n">ckd</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">Zcas</span><span class="o">/</span><span class="n">Zfo</span> <span class="o">-</span> <span class="n">Zin</span><span class="o">/</span><span class="n">Zcas</span><span class="p">)</span> <span class="o">*</span> <span class="n">skd</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">))</span> \
                <span class="o">/</span> <span class="p">(</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Zin</span><span class="o">/</span><span class="n">Zfo</span><span class="p">)</span> <span class="o">*</span> <span class="n">ckd</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">Zcas</span><span class="o">/</span><span class="n">Zfo</span> <span class="o">+</span> <span class="n">Zin</span><span class="o">/</span><span class="n">Zcas</span><span class="p">)</span> <span class="o">*</span> <span class="n">skd</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ref_coeff</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_tauF_tauMin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deriving resonance frequency and group delay minimum</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f0</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_search</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search window for group delay minimum as plus-minus from expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3taugSN</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay curve   </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tauF</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency from group delay minimum</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>taumin</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay minimum</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_tauF_tauMin</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">f0</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">f_search</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">T3taugSN</span><span class="p">:</span><span class="n">Quantity</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deriving resonance frequency and group delay minimum</span>

<span class="sd">    Args:</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        f0: expected resonance frequency</span>
<span class="sd">        f_search: search window for group delay minimum as plus-minus from expected resonance frequency</span>
<span class="sd">        T3taugSN: group delay curve   </span>

<span class="sd">    Returns:</span>
<span class="sd">        tauF: resonance frequency from group delay minimum</span>
<span class="sd">        taumin: group delay minimum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get tau frequency and tau minimum</span>
    <span class="n">f_fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">f0</span><span class="o">.</span><span class="n">magnitude</span><span class="o">+</span><span class="n">f_search</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">f0</span><span class="o">.</span><span class="n">magnitude</span><span class="o">+</span><span class="n">f_search</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">fstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>    
    <span class="n">i_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fstart</span><span class="p">,</span><span class="n">fstop</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">T3taugSN</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">tauF</span><span class="p">,</span><span class="n">taumin</span><span class="o">=</span><span class="n">find_peak</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i_range</span><span class="p">],</span><span class="n">T3taugSN</span><span class="p">[:,:,</span><span class="n">i_range</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tauF</span><span class="p">,</span><span class="n">taumin</span><span class="o">=</span><span class="n">find_peak</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i_range</span><span class="p">],</span><span class="n">T3taugSN</span><span class="p">[</span><span class="n">i_range</span><span class="p">])</span>    
    <span class="k">return</span> <span class="n">tauF</span><span class="p">,</span><span class="o">-</span><span class="n">taumin</span>   <span class="c1"># type: ignore[return-value]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.T3_tauF_tauMin1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">T3_tauF_tauMin1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deriving resonance frequency and group delay minimum for one dataset</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_search</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search window for group delay minimum as plus-minus from expected resonance frequency</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T3taugSN</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay curve   </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tauF</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency from group delay minimum</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>taumin</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>group delay minimum</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">T3_tauF_tauMin1</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">f0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f_search</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">T3taugSN</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deriving resonance frequency and group delay minimum for one dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        f: Frequency vector corresponding to the spectrum</span>
<span class="sd">        f0: expected resonance frequency</span>
<span class="sd">        f_search: search window for group delay minimum as plus-minus from expected resonance frequency</span>
<span class="sd">        T3taugSN: group delay curve   </span>

<span class="sd">    Returns:</span>
<span class="sd">        tauF: resonance frequency from group delay minimum</span>
<span class="sd">        taumin: group delay minimum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get tau frequency and tau minimum</span>
    <span class="n">f_fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">f_search</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">f0</span><span class="o">+</span><span class="n">f_search</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">fstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">f_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>    
    <span class="n">i_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fstart</span><span class="p">,</span><span class="n">fstop</span><span class="p">)</span>
    <span class="n">tauF</span><span class="p">,</span><span class="n">taumin</span><span class="o">=</span><span class="n">find_peak</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i_range</span><span class="p">],</span><span class="n">T3taugSN</span><span class="p">[</span><span class="n">i_range</span><span class="p">])</span>    
    <span class="k">return</span> <span class="n">tauF</span><span class="p">,</span><span class="o">-</span><span class="n">taumin</span>   <span class="c1"># type: ignore[return-value]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.t3.process_T3" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">process_T3</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">interval_f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limits_windows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fft_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Derive pipe thickness and impedance based on the T3 algorithm</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>interval_f</code></td>
          <td>
                <code>tuple[float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>limits for frequency search window from expected resonance frequency in Hz, default (-60000.,60000.)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>limits_windows</code></td>
          <td>
                <code>tuple[float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>give the window size in periods for the normalisation window (symmetric) and the end of the             signal window from max amplitude. Default= (2.5,7)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fft_scale</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>value to scale fft resolution, default value = 10</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>T3result</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.t3.T3result" href="#pyintegrity.pulseecho.processing.t3.T3result">T3result</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>object containing impedance and thickness</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/t3.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_T3</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
               <span class="n">interval_f</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">limits_windows</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">fft_scale</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">T3result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive pipe thickness and impedance based on the T3 algorithm</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>
<span class="sd">        interval_f: limits for frequency search window from expected resonance frequency in Hz, default (-60000.,60000.)</span>
<span class="sd">        limits_windows: give the window size in periods for the normalisation window (symmetric) and the end of the \</span>
<span class="sd">            signal window from max amplitude. Default= (2.5,7)</span>
<span class="sd">        fft_scale: value to scale fft resolution, default value = 10</span>

<span class="sd">    Returns:</span>
<span class="sd">        T3result: object containing impedance and thickness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Frequency interval</span>
    <span class="k">if</span> <span class="n">interval_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60000.</span><span class="p">,</span><span class="mf">60000.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interval_f</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_f</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The search interval needs to be given as start and stop frequency deviation from the expected &#39;</span> 
                  <span class="s1">&#39;resonance frequency in Hz. The default range [-60000, 60000] will be used. &#39;</span><span class="p">)</span>
            <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60000.</span><span class="p">,</span><span class="mf">60000.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_search</span><span class="o">=</span><span class="n">interval_f</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The search interval needs to be a tuple or a list with two values. The default range [-60000, 60000] &#39;</span>
              <span class="s1">&#39;will be used. &#39;</span><span class="p">)</span>
        <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60000.</span><span class="p">,</span><span class="mf">60000.</span><span class="p">)</span>

    <span class="c1"># Window length normalization window, processing window   </span>
    <span class="k">if</span> <span class="n">limits_windows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">7.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limits_windows</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits_windows</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Window length for normalization and signal window, two values should be given. The default window &#39;</span>
                  <span class="s1">&#39;length of 2.5 and 7 periods will be used.&#39;</span><span class="p">)</span>
            <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">7.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lim_win</span><span class="o">=</span><span class="n">limits_windows</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Window length for normalization and signal window, two values should be given. The default window &#39;</span>
              <span class="s1">&#39;length of 2.5 and 7 periods will be used.&#39;</span><span class="p">)</span>
        <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">7.</span><span class="p">)</span>    

    <span class="c1"># Scaling for fft resolution</span>
    <span class="k">if</span> <span class="n">fft_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">fft_scale</span>

    <span class="n">f_exp</span><span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>

    <span class="c1"># Preprocessing of data</span>
    <span class="n">T3freq</span><span class="p">,</span><span class="n">T3taugSN_meas</span><span class="p">,</span> <span class="n">T3N</span><span class="p">,</span> <span class="n">indT_S0</span><span class="p">,</span> <span class="n">indT_S1</span><span class="p">,</span> <span class="n">indT_N0</span><span class="p">,</span> <span class="n">indT_N1</span><span class="o">=</span><span class="n">PreStep_processing</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="n">lim_win</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>

    <span class="c1"># Group delay minimum, group delay bandwidth and resonance frequency from group-delay curve</span>
    <span class="n">fres_meas</span><span class="p">,</span><span class="n">taumin_meas</span><span class="o">=</span><span class="n">T3_tauF_tauMin</span><span class="p">(</span><span class="n">T3freq</span><span class="p">,</span> <span class="n">f_exp</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">T3taugSN_meas</span><span class="p">)</span>
    <span class="n">T3band_meas</span><span class="o">=</span><span class="n">T3_band</span><span class="p">(</span><span class="n">T3freq</span><span class="p">,</span> <span class="n">fres_meas</span><span class="p">,</span><span class="n">taumin_meas</span><span class="p">,</span> <span class="n">T3taugSN_meas</span><span class="p">)</span>


    <span class="n">Spec_firstpulse</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">T3N</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span> <span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">T3freq</span><span class="p">)</span>          
    <span class="n">fres</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">fres_meas</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">T3band_meas</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">T3result</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="n">fres</span><span class="p">,</span><span class="n">Spec_firstpulse</span><span class="p">)</span>

    <span class="c1"># derive thickness and impedance</span>
    <span class="k">if</span> <span class="n">fres</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># No resonance frequency detected</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># calculation cannot proceed further</span>
    <span class="k">if</span> <span class="n">band</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># no bandwidth detected</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Thickness is calculated from resonance frequency of group delay minimum. &#39;</span>
              <span class="s1">&#39;No optimization algorithm used.&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">calculate_thickness_fres</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="n">result</span><span class="o">.</span><span class="n">derive_impedance_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">T3band_meas</span><span class="p">,</span> <span class="n">T3freq</span><span class="p">,</span> <span class="n">f_search</span><span class="p">,</span> <span class="n">indT_S0</span><span class="p">,</span> <span class="n">indT_S1</span><span class="p">,</span> <span class="n">indT_N0</span><span class="p">,</span> <span class="n">indT_N1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="abcd-algorithm">ABCD algorithm</h2>


<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Module for ABCD processing following the description in Mandal (2000)
The algorithm is based on the derivation of the parameter Sw, the sum of the 
absolute value over the ringdown period.</p>
<p>The 1D plane wave model as given by Mandal has a 180-degree phase shift 
compared to reference solutions. This does not make a difference in context of 
this method as only the absolute values of the modelled waveform are used in 
the end. However, to have a correct result we changed this.</p>
<p>In Mandal the ABCD function is derived by combining the spectrum of multiple
measurements, here we use the spectrum of each of the measurements</p>
<p>Mandal, B., Standley, T.E., 2000. Method to determine self-calibrated 
circumferential cased bond impedance. US Patent 6,041,861.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pyintegrity.pulseecho.processing.abcd.ABCDresult" class="doc doc-heading">
          <code>pyintegrity.pulseecho.processing.abcd.ABCDresult</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.result.ProcessingResult" href="#pyintegrity.pulseecho.processing.result.ProcessingResult">ProcessingResult</a></code></p>

  
      <p>Result container for ABCD processing</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fres</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency to derive thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Sw</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the parameter Sw as defined in Mandal et al. (2000) derived from the measurement data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Spec_firstpulse</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the spectrum from the first pulse used in the convolution with the 1D model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ABCDresult</span><span class="p">(</span><span class="n">ProcessingResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result container for ABCD processing</span>

<span class="sd">    Args:</span>
<span class="sd">        fres: resonance frequency to derive thickness</span>
<span class="sd">        Sw: the parameter Sw as defined in Mandal et al. (2000) derived from the measurement data</span>
<span class="sd">        Spec_firstpulse: the spectrum from the first pulse used in the convolution with the 1D model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sw</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                 <span class="n">fres</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                 <span class="n">Spec_firstpulse</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>                          <span class="c1"># Initializes impedance behind casing and casing thickness</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sw</span><span class="o">=</span> <span class="n">Sw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">=</span> <span class="n">fres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">=</span> <span class="n">Spec_firstpulse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">:</span> <span class="n">LogChannel</span>

    <span class="k">def</span> <span class="nf">calculate_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">        Args:</span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate impedance </span>

<span class="sd">        Args: series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Z</span><span class="o">=</span><span class="n">_ABCD_Z</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Sw</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_impedance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculate impedance </p>
<p>Args: series: <code>PulseEchoSeries</code> object containing the waveform data</p>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate impedance </span>

<span class="sd">    Args: series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Z</span><span class="o">=</span><span class="n">_ABCD_Z</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Sw</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.abcd.ABCDresult.calculate_thickness" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculate thickness from resonance frequency</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.abcd.Mandal_plane_wave" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">abcd</span><span class="o">.</span><span class="n">Mandal_plane_wave</span><span class="p">(</span><span class="n">ZfoH</span><span class="p">,</span> <span class="n">Ct</span><span class="p">,</span> <span class="n">iim</span><span class="p">,</span> <span class="n">cim</span><span class="p">,</span> <span class="n">cvp</span><span class="p">,</span> <span class="n">Hafreq</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>1 D model as described  in Madal however *-1 (Mandal result has a 180 degree phase shift) </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ZfoH</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the guess for the impedance behind the pipe</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Ct</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the guess for the thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>iim</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the impedance of the fluid inside the pipe</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cim</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the impedance of the casing/pipe</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cvp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>speed of the casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Hafreq</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the frequency vector.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>R</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Transformation function</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@guvectorize</span><span class="p">([(</span><span class="n">int64</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span><span class="n">float64</span><span class="p">[:],</span><span class="n">complex128</span><span class="p">[:])],</span> <span class="s1">&#39;(),(),(),(),(),(n)-&gt;(n)&#39;</span><span class="p">,</span> \
              <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;parallel&#39;</span><span class="p">)</span>           
<span class="k">def</span> <span class="nf">Mandal_plane_wave</span><span class="p">(</span><span class="n">ZfoH</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Ct</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">iim</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">cim</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">cvp</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">Hafreq</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 1 D model as described  in Madal however *-1 (Mandal result has a 180 degree phase shift) </span>

<span class="sd">    Args:</span>
<span class="sd">        ZfoH: the guess for the impedance behind the pipe</span>
<span class="sd">        Ct: the guess for the thickness</span>
<span class="sd">        iim: the impedance of the fluid inside the pipe</span>
<span class="sd">        cim: the impedance of the casing/pipe</span>
<span class="sd">        cvp: speed of the casing</span>
<span class="sd">        Hafreq: the frequency vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        R (np.ndarray): Transformation function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cim</span><span class="o">-</span><span class="n">iim</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">iim</span><span class="o">+</span><span class="n">cim</span><span class="p">)</span> \
        <span class="o">-</span> <span class="p">(</span> <span class="p">(((</span><span class="mi">4</span><span class="o">*</span><span class="n">iim</span><span class="o">*</span><span class="n">cim</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">iim</span><span class="o">+</span><span class="n">cim</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">cim</span><span class="o">-</span><span class="n">ZfoH</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cim</span><span class="o">+</span><span class="n">ZfoH</span><span class="p">)))</span> \
           <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(((</span><span class="n">cim</span><span class="o">-</span><span class="n">iim</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">iim</span><span class="o">+</span><span class="n">cim</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">cim</span><span class="o">-</span><span class="n">ZfoH</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cim</span><span class="o">+</span><span class="n">ZfoH</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Hafreq</span><span class="p">[:]</span><span class="o">*</span><span class="n">Ct</span><span class="o">/</span><span class="n">cvp</span><span class="p">)))</span> \
           <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Hafreq</span><span class="p">[:]</span><span class="o">*</span><span class="n">Ct</span><span class="o">/</span><span class="n">cvp</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.abcd.Mandal_processing" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">abcd</span><span class="o">.</span><span class="n">Mandal_processing</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Processing of data following description in Mandal</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>f_ha</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>S_w_orig</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sw parameter derived from waveform data</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>S_Ha</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Spectrum of the first pulse used in the convolution with the plane wave model result</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>Hafreq</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frequency vector corresponding to the spectrum</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">Mandal_processing</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Processing of data following description in Mandal</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>

<span class="sd">    Returns:</span>
<span class="sd">        f_ha: resonance frequency</span>
<span class="sd">        S_w_orig: Sw parameter derived from waveform data</span>
<span class="sd">        S_Ha: Spectrum of the first pulse used in the convolution with the plane wave model result</span>
<span class="sd">        Hafreq: Frequency vector corresponding to the spectrum </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>
    <span class="n">f_exp</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">Nfft2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Hafreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nfft</span><span class="p">)</span><span class="o">/</span><span class="n">Nfft</span><span class="o">/</span><span class="p">((</span><span class="n">dt</span><span class="p">))</span>

    <span class="c1"># Fine time of maximum of first reflection</span>
    <span class="n">T_peak</span> <span class="o">=</span> <span class="n">_find_reflection</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># pylint: disable=typecheck</span>

    <span class="n">t_fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_peak</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span><span class="n">T_peak</span><span class="o">+</span><span class="mi">7</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="n">tstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">t_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">t_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Derive Sw parameter, normalized</span>
    <span class="n">S_w_orig</span><span class="o">=</span><span class="n">_get_Sw</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span><span class="n">tstart</span><span class="p">,</span><span class="n">tstop</span><span class="p">)</span>   <span class="c1"># pylint: disable=typecheck</span>

    <span class="c1"># Get resonance frequency</span>
    <span class="n">Ha_Rwin_dB</span> <span class="o">=</span> <span class="n">_res_Spec</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span><span class="n">tstop</span><span class="p">,</span><span class="n">Nfft</span><span class="p">,</span><span class="n">waveforms</span><span class="p">)</span>   <span class="c1"># pylint: disable=typecheck</span>
    <span class="n">f_ha</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">find_peak</span><span class="p">(</span><span class="n">Hafreq</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nfft2</span><span class="p">],</span><span class="n">Ha_Rwin_dB</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nfft2</span><span class="p">])</span>   <span class="c1"># pylint: disable=unsubscriptable-object</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_ha</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>

    <span class="c1"># Derive spectrum of the first reflection        </span>
    <span class="n">t_fitF</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_peak</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">f_ha</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">T_peak</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="n">f_ha</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="n">tfstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">t_fitF</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tfstop</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="n">t_fitF</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Upscaling </span>
    <span class="n">NfftS</span><span class="o">=</span><span class="n">Nfft</span><span class="o">*</span><span class="mi">10</span>
    <span class="n">waveformsScale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">NfftS</span><span class="p">])</span>
    <span class="n">waveformsScale</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span>
    <span class="n">S_Ha</span> <span class="o">=</span> <span class="n">_tukey_Spec</span><span class="p">(</span><span class="n">tfstart</span><span class="p">,</span> <span class="n">tfstop</span><span class="p">,</span> <span class="n">NfftS</span><span class="p">,</span> <span class="n">waveformsScale</span><span class="p">)</span>   <span class="c1"># pylint: disable=typecheck</span>
    <span class="n">SHafreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NfftS</span><span class="p">)</span><span class="o">/</span><span class="n">NfftS</span><span class="o">/</span><span class="p">((</span><span class="n">dt</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">f_ha</span><span class="p">,</span> <span class="n">S_w_orig</span><span class="p">,</span> <span class="n">S_Ha</span><span class="p">,</span> <span class="n">SHafreq</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.abcd.process_abcd" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">abcd</span><span class="o">.</span><span class="n">process_abcd</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Derive pipe thickness and impedance based on the abcd algorithm</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.abcd.ABCDresult" href="#pyintegrity.pulseecho.processing.abcd.ABCDresult">ABCDresult</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ABCDResult object containing impedance and thickness</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/abcd.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_abcd</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">ABCDresult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive pipe thickness and impedance based on the abcd algorithm</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>

<span class="sd">    Returns:</span>
<span class="sd">        ABCDResult object containing impedance and thickness</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_resonance</span><span class="p">,</span> <span class="n">Sw_arr</span><span class="p">,</span> <span class="n">Spec_firstpulse_arr</span><span class="p">,</span> <span class="n">fvec</span> <span class="o">=</span> <span class="n">Mandal_processing</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>  
    <span class="n">Sw</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Sw_arr</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">fres</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">f_resonance</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">Spec_firstpulse</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Spec_firstpulse_arr</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span> <span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fvec</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">ABCDresult</span><span class="p">(</span><span class="n">Sw</span><span class="p">,</span><span class="n">fres</span><span class="p">,</span><span class="n">Spec_firstpulse</span><span class="p">)</span>


    <span class="c1"># Calculate thickness and impedance</span>
    <span class="k">if</span> <span class="n">fres</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># No resonance frequency detected</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># calculation cannot proceed further</span>
    <span class="n">result</span><span class="o">.</span><span class="n">calculate_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">calculate_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="l1-algorithm">L1 algorithm</h2>


<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Module for L1 processing following the description in Tello (2010). The description in the patent is partly vague. We
use the gradient of the ringdown to determine the impedance through the optimization algorithm.</p>
<p>Tello, L.N., 2010. Ultrasonic logging methods and apparatus for automatically calibrating measures of acoustic
impedance of cement and other materials behind casing. US Patent No. US 7,755,973 B2</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="pyintegrity.pulseecho.processing.l1.L1result" class="doc doc-heading">
          <code>pyintegrity.pulseecho.processing.l1.L1result</code>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.result.ProcessingResult" href="#pyintegrity.pulseecho.processing.result.ProcessingResult">ProcessingResult</a></code></p>

  
      <p>Result container for L1 processing</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>L1</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>gradient of ringdown tail</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fres</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency derived from group-delay minimum</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Spec_firstpulse</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.logchannel.LogChannel" href="../api-fundamentals/#pyintegrity.logchannel.LogChannel">LogChannel</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the spectrum from the first pulse used in the convolution with the 1D model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">L1result</span><span class="p">(</span><span class="n">ProcessingResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result container for L1 processing</span>

<span class="sd">    Args:</span>
<span class="sd">        L1: gradient of ringdown tail</span>
<span class="sd">        fres: resonance frequency derived from group-delay minimum</span>
<span class="sd">        Spec_firstpulse: the spectrum from the first pulse used in the convolution with the 1D model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L1</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                    <span class="n">fres</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">,</span>
                    <span class="n">Spec_firstpulse</span><span class="p">:</span> <span class="n">LogChannel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>                         

        <span class="bp">self</span><span class="o">.</span><span class="n">L1</span><span class="o">=</span> <span class="n">L1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">=</span> <span class="n">fres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Spec_firstpulse</span><span class="o">=</span> <span class="n">Spec_firstpulse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">:</span> <span class="n">LogChannel</span>

    <span class="k">def</span> <span class="nf">calculate_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">        Args: </span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">derive_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                         <span class="n">Trt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                         <span class="n">freq</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                         <span class="n">win_lim</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Derive impedance using the L1 gradient value through optimization algorithm </span>

<span class="sd">        Args: </span>
<span class="sd">            series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">            Trt: transfer function, spectrum of initial pulse</span>
<span class="sd">            freq: frequency vector</span>
<span class="sd">            win_lim: window limits for calculation of ringdown gradient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>

        <span class="n">L1data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">L1data</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">casing_material</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span>
        <span class="n">inner_material</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span>
        <span class="k">assert</span> <span class="n">casing_material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">casing_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">Z_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
        <span class="n">initial_val</span> <span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">argsH</span><span class="o">=</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">casing_material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                           <span class="n">casing_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                           <span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                           <span class="n">Trt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:],</span>
                           <span class="n">L1data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                           <span class="n">win_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                           <span class="n">win_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">final_L2</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">L1_optimize</span><span class="p">,</span> <span class="n">initial_val</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">argsH</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                        <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_L2</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
                    <span class="k">except</span><span class="p">:</span>   <span class="c1"># FIXME: Specify exception type   # pylint: disable=bare-except</span>
                        <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Z_res</span><span class="p">,</span><span class="s1">&#39;MRayl&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.l1.L1result.calculate_thickness" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculate thickness from resonance frequency</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate thickness from resonance frequency</span>

<span class="sd">    Args: </span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">d</span><span class="o">=</span><span class="n">Quantity</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="pyintegrity.pulseecho.processing.l1.L1result.derive_impedance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">derive_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">Trt</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">win_lim</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Derive impedance using the L1 gradient value through optimization algorithm </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> object containing the waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Trt</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transfer function, spectrum of initial pulse</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>freq</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>win_lim</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>window limits for calculation of ringdown gradient</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">derive_impedance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                     <span class="n">Trt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="n">freq</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
                     <span class="n">win_lim</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive impedance using the L1 gradient value through optimization algorithm </span>

<span class="sd">    Args: </span>
<span class="sd">        series: `PulseEchoSeries` object containing the waveform data</span>
<span class="sd">        Trt: transfer function, spectrum of initial pulse</span>
<span class="sd">        freq: frequency vector</span>
<span class="sd">        win_lim: window limits for calculation of ringdown gradient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>

    <span class="n">L1data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">L1data</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">casing_material</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span>
    <span class="n">inner_material</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">inner_material</span>
    <span class="k">assert</span> <span class="n">casing_material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">casing_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">Z_res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
    <span class="n">initial_val</span> <span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>   <span class="c1"># pylint: disable=not-an-iterable</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">argsH</span><span class="o">=</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                       <span class="n">casing_material</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                       <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                       <span class="n">casing_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                       <span class="n">inner_material</span><span class="o">.</span><span class="n">impedance</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                       <span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
                       <span class="n">Trt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:],</span>
                       <span class="n">L1data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                       <span class="n">win_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                       <span class="n">win_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">final_L2</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">L1_optimize</span><span class="p">,</span> <span class="n">initial_val</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">argsH</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">final_L2</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
                <span class="k">except</span><span class="p">:</span>   <span class="c1"># FIXME: Specify exception type   # pylint: disable=bare-except</span>
                    <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z_res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Z_res</span><span class="p">,</span><span class="s1">&#39;MRayl&#39;</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.L1_model" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">L1_model</span><span class="p">(</span><span class="n">freqW</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">Zout</span><span class="p">,</span> <span class="n">Trt</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculation of modelled envelope based on the plane wave model</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>freqW</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vpCAS</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Tcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>derived thickness of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Z_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner fluid</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zout</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>assumption of outer-material impedance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>env</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>envelope derived  from modelled reflection coefficient</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">L1_model</span><span class="p">(</span><span class="n">freqW</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Trt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculation of modelled envelope based on the plane wave model</span>

<span class="sd">    Args:</span>
<span class="sd">        freqW: frequency vector </span>
<span class="sd">        vpCAS: P-wave speed of casing</span>
<span class="sd">        Tcas: derived thickness of casing</span>
<span class="sd">        Z_cas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner fluid</span>
<span class="sd">        Zout: assumption of outer-material impedance</span>

<span class="sd">    Returns:</span>
<span class="sd">        env: envelope derived  from modelled reflection coefficient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Tr</span> <span class="o">=</span> <span class="n">L1_planewave</span><span class="p">(</span><span class="n">freqW</span><span class="p">,</span><span class="n">vpCAS</span><span class="p">,</span><span class="n">Tcas</span><span class="p">,</span><span class="n">Z_cas</span><span class="p">,</span><span class="n">Zin</span><span class="p">,</span><span class="n">Zout</span><span class="p">)</span>
    <span class="n">Nfft</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Tr</span><span class="p">)</span>
    <span class="n">data_conv</span><span class="o">=</span><span class="n">Tr</span><span class="o">*</span><span class="n">Trt</span>
    <span class="n">data_mod</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">data_conv</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">Nfft</span><span class="p">))</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">data_mod</span><span class="p">))</span>
    <span class="n">env</span><span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.L1_optimize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">L1_optimize</span><span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">freqW</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Trt</span><span class="p">,</span> <span class="n">L1data</span><span class="p">,</span> <span class="n">indTS</span><span class="p">,</span> <span class="n">indTE</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Algorithm that calls model to optimize error between real data and model data to find the best impedance estimate</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>in_val</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>input value of impedance in MRayl</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>freqW</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vpCAS</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Tcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>derived thickness of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Z_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner fluid</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dt</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>time increment</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Trt</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transfer function, spectrum of initial reflection</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>L1data</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>reverberation  gradient from data </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indTS</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>start for window to derive L1 gradient </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indTE</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>stop for window to derive L1 gradient </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>error between gradient of measured and modelled data</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">L1_optimize</span><span class="p">(</span><span class="n">in_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">freqW</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">Trt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">L1data</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">indTS</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indTE</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Algorithm that calls model to optimize error between real data and model data to find the best impedance estimate</span>

<span class="sd">    Args:</span>
<span class="sd">        in_val: input value of impedance in MRayl</span>
<span class="sd">        freqW: frequency vector </span>
<span class="sd">        vpCAS: P-wave speed of casing</span>
<span class="sd">        Tcas: derived thickness of casing</span>
<span class="sd">        Z_cas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner fluid</span>
<span class="sd">        dt: time increment</span>
<span class="sd">        Trt: transfer function, spectrum of initial reflection</span>
<span class="sd">        L1data: reverberation  gradient from data </span>
<span class="sd">        indTS: start for window to derive L1 gradient </span>
<span class="sd">        indTE: stop for window to derive L1 gradient </span>

<span class="sd">    Returns:</span>
<span class="sd">        error between gradient of measured and modelled data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_val</span><span class="o">=</span><span class="n">in_val</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>

    <span class="n">data_modW</span> <span class="o">=</span> <span class="n">L1_model</span><span class="p">(</span><span class="n">freqW</span><span class="p">,</span><span class="n">vpCAS</span><span class="p">,</span><span class="n">Tcas</span><span class="p">,</span><span class="n">Z_cas</span><span class="p">,</span><span class="n">Zin</span><span class="p">,</span><span class="n">in_val</span><span class="p">,</span><span class="n">Trt</span><span class="p">)</span>
    <span class="n">L1mod</span><span class="o">=</span><span class="n">_L1_gradient1</span><span class="p">(</span><span class="n">data_modW</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">indTS</span><span class="p">,</span><span class="n">indTE</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">L1mod</span><span class="o">-</span><span class="n">L1data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.L1_planewave" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">L1_planewave</span><span class="p">(</span><span class="n">freqW</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">,</span> <span class="n">Zin</span><span class="p">,</span> <span class="n">Zout</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plane wave calculation using derived thickness and assumption for
outer-material impedance</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>freqW</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vpCAS</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>P-wave speed of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Tcas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>derived thickness of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Z_cas</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of casing</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zin</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>impedance of inner fluid</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Zout</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>assumption of outer-material impedance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Tr</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>reflection coefficient form plane wave model</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">L1_planewave</span><span class="p">(</span><span class="n">freqW</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vpCAS</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tcas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Z_cas</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Zout</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plane wave calculation using derived thickness and assumption for</span>
<span class="sd">    outer-material impedance</span>

<span class="sd">    Args:</span>
<span class="sd">        freqW: frequency vector </span>
<span class="sd">        vpCAS: P-wave speed of casing</span>
<span class="sd">        Tcas: derived thickness of casing</span>
<span class="sd">        Z_cas: impedance of casing</span>
<span class="sd">        Zin: impedance of inner fluid</span>
<span class="sd">        Zout: assumption of outer-material impedance</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tr: reflection coefficient form plane wave model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freqW</span><span class="o">/</span><span class="n">vpCAS</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">Tcas</span><span class="p">)</span>  
    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="n">Z_cas</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">Tcas</span><span class="p">)</span>
    <span class="n">C</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">Z_cas</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">Tcas</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">Tcas</span><span class="p">)</span> 
    <span class="n">Tr</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">Zin</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">Zout</span><span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="n">Zin</span><span class="o">*</span><span class="n">Zout</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C</span><span class="o">*</span><span class="n">Zin</span><span class="o">*</span><span class="n">Zout</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">Zout</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">Zin</span><span class="o">+</span><span class="n">B</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">Tr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.L1_preprocessing" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">L1_preprocessing</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">wlim</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Preprocessing of the data to derive group delay curve, resonance frequency, group delay minimum and bandwidth         of minimum</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>wlim</code></td>
          <td>
                <code>tuple[float, float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>limits for windows as periods from max amplitude, first value symmetric to derive first pulse, 2. and             3. value start and stop to derive L1 gradient</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>scale</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>scaling factor for higher resolution for frequency resolution</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>TrO</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transfer function, spectrum of entire pulse</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>Trt</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transfer function, spectrum of initial pulse</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>freqW</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>env</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>envelope of signals</p>
            </div>
          </td>
        </tr>
        <tr>
<td></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[indT2,indT3]: window limits for calculation of ringdown gradient</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">L1_preprocessing</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
                     <span class="n">wlim</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                     <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Preprocessing of the data to derive group delay curve, resonance frequency, group delay minimum and bandwidth \</span>
<span class="sd">        of minimum</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>
<span class="sd">        wlim: limits for windows as periods from max amplitude, first value symmetric to derive first pulse, 2. and \</span>
<span class="sd">            3. value start and stop to derive L1 gradient</span>
<span class="sd">        scale: scaling factor for higher resolution for frequency resolution</span>

<span class="sd">    Returns:</span>
<span class="sd">        TrO: transfer function, spectrum of entire pulse</span>
<span class="sd">        Trt: transfer function, spectrum of initial pulse</span>
<span class="sd">        freqW: frequency vector</span>
<span class="sd">        env: envelope of signals</span>
<span class="sd">        [indT2,indT3]: window limits for calculation of ringdown gradient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>
    <span class="n">f_exp</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">waveforms</span><span class="p">))</span>
    <span class="n">env</span><span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">t_max</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">find_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">env</span><span class="p">)</span>
    <span class="p">[</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Find sample number for window</span>
    <span class="n">t_W</span><span class="o">=</span><span class="p">[</span><span class="n">t_max</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="n">t_max</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="n">t_max</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="n">wlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
         <span class="n">t_max</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">*</span><span class="n">wlim</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
    <span class="n">indT0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_W</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># First sample index of the range</span>
    <span class="n">indT1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_W</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># second sample index of the range</span>
    <span class="n">indT2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_W</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># third sample index of the range</span>
    <span class="n">indT3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_W</span><span class="p">[</span><span class="mi">3</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># third sample index of the range</span>

    <span class="c1"># Windowed data</span>
    <span class="n">NfftS</span><span class="o">=</span><span class="n">Nfft</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">waveformsScale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">NfftS</span><span class="p">])</span>
    <span class="n">waveformsScale</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nfft</span><span class="p">]</span><span class="o">=</span><span class="n">waveforms</span>

    <span class="n">Trt</span><span class="o">=</span><span class="n">_tukey_Spec</span><span class="p">(</span><span class="n">indT0</span><span class="p">,</span><span class="n">indT1</span><span class="p">,</span><span class="n">NfftS</span><span class="p">,</span><span class="n">waveformsScale</span><span class="p">)</span>  <span class="c1"># initial pulse for 1D plane wave model #pylint: disable=typecheck</span>
    <span class="n">TrO</span><span class="o">=</span><span class="n">_tukey_Spec</span><span class="p">(</span><span class="n">indT0</span><span class="p">,</span><span class="n">indT3</span><span class="p">,</span><span class="n">NfftS</span><span class="p">,</span><span class="n">waveformsScale</span><span class="p">)</span>  <span class="c1"># to derive thickness    #pylint: disable=typecheck</span>

    <span class="n">freqW</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NfftS</span><span class="p">)</span><span class="o">/</span><span class="n">NfftS</span><span class="o">/</span><span class="p">((</span><span class="n">dt</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">TrO</span><span class="p">,</span> <span class="n">Trt</span><span class="p">,</span> <span class="n">freqW</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="p">[</span><span class="n">indT2</span><span class="p">,</span><span class="n">indT3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.find_resonance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">find_resonance</span><span class="p">(</span><span class="n">TrO</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_exp</span><span class="p">,</span> <span class="n">fW</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Derive resonance frequency from spectrum from entire signal</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>TrO</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transfer function, spectrum of entire pulse</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frequency vector</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>f_exp</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>expected resonance frequency from nominal thickness</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fW</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Search window size plus/minus</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fres</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.Quantity" href="../api-fundamentals/#pyintegrity.Quantity">Quantity</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>resonance frequency</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_resonance</span><span class="p">(</span><span class="n">TrO</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">f_exp</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">fW</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Quantity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Derive resonance frequency from spectrum from entire signal</span>

<span class="sd">    Args:</span>
<span class="sd">        TrO: transfer function, spectrum of entire pulse</span>
<span class="sd">        f: frequency vector</span>
<span class="sd">        f_exp: expected resonance frequency from nominal thickness</span>
<span class="sd">        fW: Search window size plus/minus</span>

<span class="sd">    Returns:</span>
<span class="sd">        fres: resonance frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indf0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="p">(</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">+</span><span class="n">fW</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>  <span class="c1"># First sample index of the range</span>
    <span class="n">indf1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="p">(</span><span class="n">f_exp</span><span class="o">.</span><span class="n">magnitude</span><span class="o">+</span><span class="n">fW</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

    <span class="n">fres</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">find_peak</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">indf0</span><span class="p">:</span><span class="n">indf1</span><span class="p">],</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">TrO</span><span class="p">[:,:,</span><span class="n">indf0</span><span class="p">:</span><span class="n">indf1</span><span class="p">])))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fres</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fres</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.hilbert1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">hilbert1</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>implementation of Hilbert transform for usage with numba</p>
<h4 id="pyintegrity.pulseecho.processing.l1.hilbert1--httpsstackoverflowcomquestions56380536hilbert-transform-in-python">https://stackoverflow.com/questions/56380536/hilbert-transform-in-python</h4>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>u</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>input signal</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>v</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>derived Hilbert transform</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">hilbert1</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; implementation of Hilbert transform for usage with numba</span>
<span class="sd">    # https://stackoverflow.com/questions/56380536/hilbert-transform-in-python</span>

<span class="sd">    Args:</span>
<span class="sd">        u: input signal</span>

<span class="sd">    Returns:</span>
<span class="sd">        v: derived Hilbert transform</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="c1"># take forward Fourier transform</span>
    <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># zero out negative frequency components</span>
    <span class="n">U</span><span class="p">[</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span>   <span class="c1"># pylint: disable=unsupported-assignment-operation</span>
    <span class="c1"># double fft energy except @ DC0</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>   <span class="c1"># pylint: disable=unsupported-assignment-operation</span>
    <span class="c1"># take inverse Fourier transform</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="pyintegrity.pulseecho.processing.l1.process_L1" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pyintegrity</span><span class="o">.</span><span class="n">pulseecho</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">l1</span><span class="o">.</span><span class="n">process_L1</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">interval_f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limits_windows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fft_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Derive pipe thickness and impedance based on the L1 algorithm</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>series</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.series.PulseEchoSeries" href="../api-pulseecho-data/#pyintegrity.pulseecho.series.PulseEchoSeries">PulseEchoSeries</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>PulseEchoSeries</code> containing input waveform data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>interval_f</code></td>
          <td>
                <code>tuple[float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>limits for frequency search window from expected resonance frequency in Hz, default (-40000,40000)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>limits_windows</code></td>
          <td>
                <code>tuple[float, float, float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>define window size as number of periods from maximum amplitude for the window defining the             initial pulse (symmetric) and the window to derive the L1 parameter, default (1.5,3,9)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fft_scale</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>scaling factor for higher frequency resolution</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>L1Result</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pyintegrity.pulseecho.processing.l1.L1result" href="#pyintegrity.pulseecho.processing.l1.L1result">L1result</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>object containing impedance and thickness</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/pyintegrity/pulseecho/processing/l1.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_L1</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">PulseEchoSeries</span><span class="p">,</span>
               <span class="n">interval_f</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">limits_windows</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">fft_scale</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">L1result</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive pipe thickness and impedance based on the L1 algorithm</span>

<span class="sd">    Args:</span>
<span class="sd">        series: `PulseEchoSeries` containing input waveform data</span>
<span class="sd">        interval_f: limits for frequency search window from expected resonance frequency in Hz, default (-40000,40000)</span>
<span class="sd">        limits_windows: define window size as number of periods from maximum amplitude for the window defining the \</span>
<span class="sd">            initial pulse (symmetric) and the window to derive the L1 parameter, default (1.5,3,9)</span>
<span class="sd">        fft_scale: scaling factor for higher frequency resolution</span>

<span class="sd">    Returns:</span>
<span class="sd">        L1Result: object containing impedance and thickness</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="c1"># Frequency interval</span>
    <span class="k">if</span> <span class="n">interval_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">40000.</span><span class="p">,</span><span class="mf">40000.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interval_f</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_f</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The search interval needs to be given as start and stop frequency deviation from the expected &#39;</span>
                  <span class="s1">&#39;resonance frequency in Hz. The default range [-40000, 40000] will be used.&#39;</span><span class="p">)</span>
            <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">40000.</span><span class="p">,</span><span class="mf">40000.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_search</span><span class="o">=</span><span class="n">interval_f</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The search interval needs to be a tuple or a list with two values. The default range [-40000, 40000] &#39;</span>
              <span class="s1">&#39;will be used.&#39;</span><span class="p">)</span>
        <span class="n">f_search</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">40000</span><span class="p">,</span><span class="mi">40000</span><span class="p">)</span>   

     <span class="c1"># Window length normalization window, processing window   </span>
    <span class="k">if</span> <span class="n">limits_windows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limits_windows</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits_windows</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start and stop limits for the windows, 3 values as number of periods from the max pulse amplitude &#39;</span>
                  <span class="s1">&#39;should be given. Symmetric value for the window defining the first pulse, and start and stop of the &#39;</span>
                  <span class="s1">&#39;window for the L1 calculation. Default used (1.5,3,9)&#39;</span><span class="p">)</span>
            <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lim_win</span><span class="o">=</span><span class="n">limits_windows</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start and stop limits for the windows, 3 values as number of periods from the max pulse amplitude &#39;</span>
              <span class="s1">&#39;should be given. Symmetric value for the window defining the first pulse, and start and stop of the &#39;</span>
              <span class="s1">&#39;window for the L1 calculation. Default used (1.5,3,9)&#39;</span><span class="p">)</span>
        <span class="n">lim_win</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">)</span>    

     <span class="c1"># Scaling for fft resolution</span>
    <span class="k">if</span> <span class="n">fft_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">fft_scale</span>

    <span class="n">TrO</span><span class="p">,</span> <span class="n">Trt</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">win_lim</span> <span class="o">=</span> <span class="n">L1_preprocessing</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="n">lim_win</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>    
    <span class="n">Spec_firstpulse</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">Trt</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span> <span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
        <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">f_exp</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">series</span><span class="o">.</span><span class="n">casing</span><span class="o">.</span><span class="n">thickness_nominal</span><span class="p">)</span>
    <span class="n">f_resonance</span><span class="o">=</span><span class="n">find_resonance</span><span class="p">(</span><span class="n">TrO</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">f_exp</span><span class="p">,</span><span class="n">f_search</span><span class="p">)</span>
    <span class="n">fres</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">f_resonance</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">series</span><span class="o">.</span><span class="n">sampling_freq</span>
    <span class="n">L1data</span><span class="o">=</span><span class="n">_L1_gradient</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span><span class="n">win_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">win_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   <span class="c1">#pylint: disable=typecheck</span>
    <span class="n">L1</span> <span class="o">=</span> <span class="n">LogChannel</span><span class="p">(</span><span class="n">L1data</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="n">result</span><span class="o">=</span><span class="n">L1result</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">fres</span><span class="p">,</span><span class="n">Spec_firstpulse</span><span class="p">)</span>

    <span class="c1"># Calculate thickness</span>
    <span class="k">if</span> <span class="n">fres</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># No resonance frequency detected</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># calculation cannot proceed further</span>
    <span class="n">result</span><span class="o">.</span><span class="n">calculate_thickness</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">L1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>      <span class="c1"># No L1 gradient derived</span>
        <span class="k">return</span> <span class="n">result</span>   <span class="c1"># calculation cannot proceed further</span>
    <span class="n">result</span><span class="o">.</span><span class="n">derive_impedance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="n">Trt</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">win_lim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>